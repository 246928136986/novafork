<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Nova</title>
    <link rel="icon" type="image/x-icon" href="https://raw.githubusercontent.com/ambr0sial/nova/main/logo.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <meta content="Nova" property="og:title"/>
    <meta content="Click, watch, enjoy. Nova breaks down the paywall, ensuring that quality content is accessible to everyone." property="og:description"/>
    <meta content="https://novastream.top" property="og:url"/>
    <meta content="https://raw.githubusercontent.com/ambr0sial/nova/main/logo.png" property="og:image"/>
    <meta content="#A17FC0" data-react-helmet="true" name="theme-color"/>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="themes/themes.css"> <!-- Link to the external CSS file -->
    <link rel="stylesheet" href="themes/mediacard.css"> <!-- Link to the media card CSS file -->
</head>
<body>
<a href="https://ko-fi.com/ambrosial" target="_blank" id="kofiButton">
    <img src="https://assets-global.website-files.com/5c14e387dab576fe667689cf/64f1a9ddd0246590df69e9ef_ko-fi_logo_02-p-500.png" alt="Ko-Fi">
</a>
<a href="https://github.com/ambr0sial/nova" target="_blank" id="githubButton">
    <img src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" alt="GitHub">
</a>

<div id="loginPage" class="min-h-screen flex items-center justify-center">
    <div class="w-full max-w-lg p-8 space-y-6 bg-zinc-800 rounded-lg shadow-lg">
        <h1 class="text-4xl font-bold text-center">Nova</h1>
        <p class="text-sm text-zinc-400 text-center">Please input your TMDB API key to access the service.</p>
        <form id="apiKeyForm" class="space-y-4">
            <input type="text" id="apiKeyInput" placeholder="Enter your TMDB API Key here" class="w-full p-3 rounded bg-zinc-700 text-white focus:outline-none focus:ring-2 focus:ring-purple-500">
            <button type="submit" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                Submit
            </button>
            <div class="text-center text-sm text-zinc-400">or</div>
            <button type="button" id="usePublicApiKey" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                Use a public API key
            </button>
        </form>
        <p class="text-xs text-zinc-400 text-center">
            Note: If the public API key doesn't work anymore, just use your own. It will rarely be updated as it's not my main priority.
        </p>
    </div>
</div>

<div id="homePage" class="hidden">
    <div class="container mx-auto px-4 py-8">
        <header class="flex justify-between items-center py-4">
            <h1 class="text-3xl font-bold text-purple-400">Nova</h1>
            <div class="text-center text-sm text-zinc-400 mt-4">This website is not affiliated with novastream.to</div>
        </header>
        <div class="flex gap-4 mb-8">
            <div class="relative flex-1">
                <input type="text" id="searchInput" placeholder="Search for something" class="w-full p-3 rounded-l bg-zinc-800 border border-zinc-700 focus:border-purple-500 focus:outline-none">
                <button id="searchButton" class="absolute inset-y-0 right-0 bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-r">Search</button>
                <div id="searchSuggestions" class="absolute w-full bg-zinc-800 text-white rounded-b-lg mt-1 hidden"></div>
            </div>
            <button id="randomButton" class="bg-zinc-700 hover:bg-zinc-600 text-white font-bold py-2 px-4 rounded">Random Movie</button>
        </div>
        <h2 class="text-xl font-semibold mb-4">Upcoming Media</h2>
        <div id="upcomingMedia" class="mb-8 ml-0"></div>
        <h2 class="text-xl font-semibold mb-4">Popular Media</h2>
        <div id="popularMovies" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4"></div>
        <div id="paginationControls" class="flex justify-center items-center mt-4">
            <button id="prevPage" class="bg-zinc-700 hover:bg-zinc-600 text-white font-bold py-2 px-4 rounded mx-2">Previous</button>
            <span id="currentPage" class="text-white mx-2">1</span>
            <button id="nextPage" class="bg-zinc-700 hover:bg-zinc-600 text-white font-bold py-2 px-4 rounded mx-2">Next</button>
        </div>
        <h2 class="text-xl font-semibold mt-8 mb-4">Selected Media</h2>
        <div id="selectedMovie" class="bg-zinc-800 p-4 rounded-lg flex">
            <div id="videoPlayer" class="w-full h-full"></div>
        </div>
        <footer class="text-center text-gray-400 mt-8">
            Made with <span id="homeHeartIcon" class="cursor-pointer" onmouseover="this.style.color='red'" onmouseout="this.style.color=''">♥</span> by Ambrosial. Latest version: 12/08/24
        </footer>
        <div class="text-center text-sm text-zinc-400 mt-4">
            Nova doesn't store files, but provides links to external services. Legal issues should be discussed with file providers and hosts. The files provided by video providers are not covered by Nova.
        </div>
        <div id="welcomeBanner" class="fixed bottom-0 left-0 right-0 bg-gray-800 text-white p-4 text-center">
            <button id="closeBanner" class="text-gray-300 hover:text-white float-right mt-1 mr-1">×</button>
            <p>Welcome to Nova! Here are our only official domains:</p>
            <p>novastream.top &nbsp; novastream.vercel.app &nbsp; novastream-alt.netlify.app &nbsp; novastream.onrender.com</p>
        </div>
    </div>
</div>

<!-- Include the updated media player script -->
<script src="media/mediaplayer.js"></script>
<!-- Include the updated search results script -->
<script src="search/searchResults.js"></script>
</body>
</html>





<script>
        document.addEventListener('DOMContentLoaded', function () {
            const loginPage = document.getElementById('loginPage');
            const homePage = document.getElementById('homePage');
            const apiKeyForm = document.getElementById('apiKeyForm');
            const welcomeBanner = document.getElementById('welcomeBanner');
            const closeBanner = document.getElementById('closeBanner');

            closeBanner.addEventListener('click', () => {
                welcomeBanner.style.display = 'none';
            });

            apiKeyForm.addEventListener('submit', async function(event) {
                event.preventDefault();
                const apiKey = document.getElementById('apiKeyInput').value;
                const response = await fetch(`https://api.themoviedb.org/3/movie/550?api_key=${apiKey}`);
                if (response.ok) {
                    localStorage.setItem('apiKey', apiKey);
                    loginPage.classList.add('hidden');
                    homePage.classList.remove('hidden');
                    fetchPopularMovies(apiKey);
                } else {
                    alert('API Key is invalid. Please try again.');
                }
            });

            document.getElementById('usePublicApiKey').addEventListener('click', async function() {
                const publicKey = '1070730380f5fee0d87cf0382670b255';
                document.getElementById('apiKeyInput').value = publicKey;
                const response = await fetch(`https://api.themoviedb.org/3/movie/550?api_key=${publicKey}`);
                if (response.ok) {
                    localStorage.setItem('apiKey', publicKey);
                    loginPage.classList.add('hidden');
                    homePage.classList.remove('hidden');
                    fetchPopularMovies(publicKey);
                } else {
                    alert('Public API Key is invalid. Please try using your own key.');
                }
            });

            const searchInput = document.getElementById('searchInput');

            document.getElementById('searchButton').addEventListener('click', search);
            searchInput.addEventListener('keydown', async function(event) {
                if (event.key === 'Enter') {
                    event.preventDefault();
                    search();
                }
            });

            async function search() {
                const apiKey = localStorage.getItem('apiKey');
                const searchInputValue = searchInput.value;
                const response = await fetch(`https://api.themoviedb.org/3/search/multi?api_key=${apiKey}&query=${searchInputValue}`);
                if (response.ok) {
                    const data = await response.json();
                    displaySearchResults(data.results);
                    searchSuggestions.classList.add('hidden');
                }
            }

            const searchSuggestions = document.getElementById('searchSuggestions');

            searchInput.addEventListener('input', async function() {
                const apiKey = localStorage.getItem('apiKey');
                const query = searchInput.value;
                if (query.length > 2) {
                    const response = await fetch(`https://api.themoviedb.org/3/search/multi?api_key=${apiKey}&query=${query}`);
                    if (response.ok) {
                        const data = await response.json();
                        displaySearchSuggestions(data.results);
                    } else {
                        searchSuggestions.classList.add('hidden');
                    }
                } else {
                    searchSuggestions.classList.add('hidden');
                }
            });



            async function fetchPopularMovies(apiKey, page = 1) {
                const response = await fetch(`https://api.themoviedb.org/3/trending/all/week?api_key=${apiKey}&page=${page}`);
                if (response.ok) {
                    const data = await response.json();
                    displaySearchResults(data.results);
                    updatePaginationControls(data.page, data.total_pages);
                    fetchUpcomingMedia(apiKey);
                } else {
                    console.error('Failed to fetch popular media.');
                }
            }

            function updatePaginationControls(currentPage, totalPages) {
                const prevPageButton = document.getElementById('prevPage');
                const nextPageButton = document.getElementById('nextPage');
                const currentPageSpan = document.getElementById('currentPage');

                currentPageSpan.textContent = currentPage;

                prevPageButton.disabled = currentPage === 1;
                nextPageButton.disabled = currentPage === totalPages;

                prevPageButton.onclick = () => changePage(currentPage - 1);
                nextPageButton.onclick = () => changePage(currentPage + 1);
            }

            function changePage(page) {
                const apiKey = localStorage.getItem('apiKey');
                fetchPopularMovies(apiKey, page);
            }
            async function fetchSelectedMedia(apiKey, mediaId, mediaType) {
                const response = await fetch(`https://api.themoviedb.org/3/${mediaType}/${mediaId}?api_key=${apiKey}`);
                if (response.ok) {
                    const media = await response.json();
                    displaySelectedMedia(media, mediaType);
                } else {
                    console.error('Failed to fetch media details.');
                }
            }


            function displaySearchResults(results) {
                const popularMovies = document.getElementById('popularMovies');
                popularMovies.innerHTML = '';

                results.forEach(media => {
                    const mediaCard = document.createElement('div');
                    mediaCard.classList.add('media-card', 'bg-gray-900', 'p-6', 'rounded-lg', 'shadow-lg', 'cursor-pointer', 'transition-transform', 'hover:scale-105', 'relative', 'flex', 'flex-col', 'items-start', 'group', 'overflow-hidden');

                    // Format the release date
                    const formattedDate = media.release_date ? new Date(media.release_date).toLocaleDateString() : (media.first_air_date ? new Date(media.first_air_date).toLocaleDateString() : 'Unknown Date');

                    // Create star rating
                    const ratingStars = Array.from({ length: 5 }, (_, i) => i < Math.round(media.vote_average / 2) ? '★' : '☆').join(' ');

                    mediaCard.innerHTML = `
            <div class="relative w-full h-80 overflow-hidden rounded-lg mb-4">
                <img src="https://image.tmdb.org/t/p/w300${media.poster_path}" alt="${media.title || media.name}" class="w-full h-full object-cover rounded-lg transition-transform duration-300 group-hover:scale-105">
                <div class="absolute inset-0 bg-gradient-to-t from-black to-transparent opacity-40"></div>
            </div>
            <div class="w-full">
                <h3 class="text-xl font-semibold text-white truncate">${media.title || media.name}</h3>
                <p class="text-gray-400 text-sm mt-1">${media.media_type === 'movie' ? '🎬 Movie' : '📺 TV Show'}</p>
                <div class="flex items-center mt-2">
                    <span class="text-yellow-400 text-lg">${ratingStars}</span>
                    <span class="text-gray-300 text-sm ml-2">${media.vote_average.toFixed(1)}/10</span>
                </div>
                <p class="text-gray-300 text-sm mt-1">Release Date: ${formattedDate}</p>
            </div>
        `;

                    mediaCard.addEventListener('click', function() {
                        fetchSelectedMedia(localStorage.getItem('apiKey'), media.id, media.media_type);
                    });

                    popularMovies.appendChild(mediaCard);
                });
            }




            async function fetchUpcomingMedia(apiKey) {
                const response = await fetch(`https://api.themoviedb.org/3/movie/upcoming?api_key=${apiKey}&language=en-US&page=1`);
                if (response.ok) {
                    const data = await response.json();
                    const upcomingMovies = data.results.filter(media => new Date(media.release_date) > new Date());
                    displayUpcomingMedia(upcomingMovies);
                } else {
                    console.error('Failed to fetch upcoming media.');
                }
            }

            function displayUpcomingMedia(mediaList) {
                const upcomingMedia = document.getElementById('upcomingMedia');
                upcomingMedia.innerHTML = '';

                mediaList.forEach(media => {
                    const mediaItem = document.createElement('div');
                    mediaItem.classList.add('text-zinc-300', 'mb-2');
                    mediaItem.innerHTML = `<span>${media.title}:</span> <span>${media.release_date}</span>`;
                    upcomingMedia.appendChild(mediaItem);
                });
            }
        });
    </script>
</body>
</html>
